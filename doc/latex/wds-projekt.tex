\documentclass[12pt,a4paper,polish]{article}
\topmargin -1.6cm
\addtolength{\textheight}{4cm}
\textwidth  15.5cm

\leftmargin      5mm
\rightmargin     5mm
\oddsidemargin   5mm
\evensidemargin  5mm

\usepackage{hyperref}
\usepackage{polski}
\usepackage[utf8]{inputenc}
\usepackage{graphicx} % To jest pakiet do grafiki.
                      % Moze przydac sie pozniej.
\usepackage{units}
\usepackage{sty/wds}


\wdsTytulProjektu{RoboVision}
\wdsAutor{Marcin Bober, 249426}



\begin{document}
%
% To po to, aby mieć format A4.
% pdflatex domyślnie tworzy dokument w formacie letter.
%
\pdfpageheight   297mm
\pdfpagewidth    210mm

\wdsStronaTytulowa
\wdsSpisTresci


 \section{Charakterystyka tematu projektu}
 \label{sekcja-charakterystyka}

  Projekt ma na celu stworzenie aplikacji okienkowej, która poprzez połączenie
  internetowe będzie w stanie wydawać polecenia do robota mobilnego, sterować nim,
  a także pobierać informacje z czujników i wizualizować je.

 \section{Podcele i etapy realizacji projektu}

  Projekt powdzielony będzie na kilka pomniejszych celów tak, aby każdy z nich
  mógłbyć osobno rozwijany. \\

  Lista podelów:
  \begin{itemize}
    \item Zapoznanie się z dostępną literaturą związaną z tematem oraz zdobycie 
    informacji niezbędnych do zrealizowania zadania.
    \item Przygotowanie graficznego szkicu aplikacji wraz z rozplanowaniem funkcionalności.
    \item Zdefiniowanie protokołu komunikacyjnego, struktury ramek przesyłanych danych
     i implementacja interfejsu sieciowego.
    \item Parsowanie danych odbieraych z robota.
    \item Przygotowanie wizualizacji zebranych danych.
    \item Obsługa joysticka.
    \item Implementacja algorytmu sterowania i przesyłanie wyników do urządzenia.
  \end{itemize}

 \section{Specyfikacja finalnego produktu}

  Aplikacja będzie w stanie wizualizować dane odbierane z czujników robota.
  Będą to między innymi:
  \begin{itemize}
    \item wskazania akcelometru,
    \item wskazania żyroskopu,
    \item aproksymacja poziomu baterii,
    \item odlegość przeszkody zczytanej z przedniego czujnika ultradzwiękowego,
    \item prędkość rzeczywista pojazdu z enkoderów.
  \end{itemize}
  

  \newpage
  \section{Terminarz realizacji poszczególnych podcelów 
     {\small (z dokładnością do 1 tygodnia)}}

  \begin{itemize}
    \item 22 marca 2020  -- zakończenie przeglądu materiałów
                            związanych z danym tematem
    \item 29 marca 2020 -- przygotowanie schematu widoku aplikacji
    \item 12 kwietnia 2020 -- oprogramowanie obsługi joysticka
    \item 19 kwietnia 2020 -- zdefiniowanie protokołu komunikacji i budowy przesyłanych ramek
    \item 26 kwietnia 2020 -- przygotowanie logiki sterownia
    \item  4 maja 2020 -- implementacja dwustronnej komunikacji z robotem
    \item 10 maja 2020 -- wizualizacja wskazań prędkości i naładowania baterii
    \item 17 maja 2020 -- wizualizacja wskazań akcelometru
    \item 24 maja 2020 -- przygotowanie wizualizacji obiektu 3D
    \item 31 maja 2020 -- implementacja obracania obiektu 3D przy użyciu żyroskopu
    \item  7 czerwca 2020 -- szukanie błędów i testowanie wszystkich funkcji
    \item 14 czerwca 2020 -- ostateczne testy działania aplikacji
  \end{itemize}

  \begin{figure}[ht]
    \centering
    \includegraphics[width=1\textwidth]{img/gantt1.png}
    \includegraphics[width=1\textwidth]{img/gantt2.png}
    \caption{Diagram Gantta}
    \label{fig:ogniwa}
  \end{figure}


  \newpage

  \section{Projekt interfejsu graficznego}
  \begin{figure}[ht]
    \centering
    \includegraphics[width=1\textwidth]{img/schemat2.png}
    \caption{Szablon interfejsu graficznego}
    \label{fig:interfejs}
  \end{figure}

  Największy wycinek okna przeznaczony jest na prezentowanie modelu
  robota w trójwymiarze (1). Obiekt ten będzie obracał się zgodnie z
  wskazaniami akcelometru zamontowanego na realnym pojeżdzie. Będzie
  więc to wizualizacja ustawienia robota w przestrzeni.

  Po prawej stonie widniejąc trzy wykresy prezentujące pomiary
  akcelometru w 3 osiach (2). Poniżej znajdują się kolejno wskażniki 
  opóźnienia  komunikacji (3), prędkości liniowej pojazdu (4) i odległości od
  przeszkody (5), a także poziom naładowania baterii (6).

  Na dolnej belce umieszczona jest informacja o podłączonym kontrolerze (7),
  i słownym statusie komunikacji z robotem (8).
  
  Na szczycie aplikacji znajduje się belka narzędziowa (9), która zawiera 
  opcję nawiązania/zerwania połączenia, wyjście z programu i informację
  o autorze aplikacji. Po wybraniu funkcji połączenia z robotem, 
  wyświetli się dodatkowe okienko z możliwością wprowadzenia adresu 
  sterowanego obiektu i przycisk umożliwiający inicjację połączenia.
  
  \section{Komunikacja z robotem}

  Połączenie z robotem odbywa się poprzez sieć WiFi. W pierwszej kolejności 
  nawiązywane jest połączenie przy użyciu protokołu TCP. Jeśli się ono powiedzie
  to uruchamiana jest dodatkowa transmicja z wykorzystaniem UDP. 
  Dzięki takiej koncepcji mamy dwa niezależne kanały komunikacji. Pierwszy służy
  do przesyłania danych które mają niski piorytet czasowy, potrzebują potwierdzenia
  odebrania i ewentualnej retransmisji danych. Druga droga komunikacji powstała, 
  aby przesyłać ciągły strumień nowych danych. Zależy nam na jaknajniższym opóźnieniu,
  a ewentualny błąd trasmisji nie jest krytyczny, bo inforamcje te szybko się 
  przedawniają i są zastępowane przez nowe, świeższe. \newline

  Każda ramka zaczyna się od wybranej dużej litery alfabetu, określającej rodzaj 
  przesyłanych danych. Dla protokołu TCP są to:

      \begin{itemize}
        \item P - ping,
        \item D - dystans przeszkody,
        \item B - bateria,
        \item S - realna predkość.
      \end{itemize}
      
  Natomiast dla protokołu UDP wyróżniamy:
    \begin{itemize}
      \item E - moc silników,
      \item A - akcelometr,
      \item G - żyroskop.
    \end{itemize}

  Wszystkie paczki danych zakończone są średnikiem, przed którym znajduje się
  ośmiobitowy cykliczny kod nadmiarowy. Niestety ze względu na róźnorodność 
  transmitownych informacji, w tym miejscu kończą się cechy wspólne poszczególnych 
  ramek.

  \subsection{Ping}
  Jest to najprostrza z obecych tu ramek. Nie przenosi żadnych informacji.
  Oznacza jedynie koniecność odesłania do nadawcy identyczniej wiadomości,
  aby można było wyznaczyć chwilę czasowe, niezbędne do obliczenia opóźnienia
  transmisji.

  Forma ramki to: $P\#;$

  Gdzie \# oznacza CRC.



  \subsection{Dystans przeszkody}
  Przesyła informacje z robota o odległości odczytanej z czujnika ultradzwiękowego.
  
  Forma ramki to: $D<uint8\_t>\#$;
  \newline

  Gdzie \# oznacza CRC. Przed nim znajduje się wartość odległości wyrażonej 
  w centymetrach, w zakresie 0-100cm.



  \subsection{Bateria}
  Przesyła informacje z robota o poziomie baterii.

  Forma ramki to: $B<uint8\_t>\#$;
  \newline

  Gdzie \# oznacza CRC. Przed nim znajduje się poziom baterii wyrażonej 
  w procentach, w zakresie 0-100\%.



  \subsection{Prędkość}
  Przesyła informacje z robota o prędkości na kołach.

  Forma ramki to: $S<uint8\_t> <uint8\_t>\#$;
  \newline

  Gdzie \# oznacza CRC. Przed nim znajdujdują się dwie wartości oddzielone spacją
  odnoszące się do prędkości poszczególnych kół wyrażonej w metrach na sekunde.



  \subsection{Moc silników}
  Przesyła informacje z aplikacji do robota o zadanej mocy silników.

  Forma ramki to: $E<uint8\_t> <uint8\_t>\#$;
  \newline

  Gdzie \# oznacza CRC. Przed nim znajdujdują się dwie wartości oddzielone spacją
  odnoszące się do zadanej mocy poszczególnych kół wyrażonej w procentach.
  Zakresy tych wartości musza mieścić się od 0 do 100\%



  \subsection{Akcelometr}
  Przesyła informacje z robota o aktualnych wskazaniach akcelometru.

  Forma ramki to: $A<uint8\_t> <uint8\_t> <uint8\_t>\#$;
  \newline

  Gdzie \# oznacza CRC. Przed nim znajdujdują się trzy wartości oddzielone spacją
  odnoszące się do aktualnych wskazań akcelometru.


  \subsection{Żyroskop}
  Przesyła informacje z robota o aktualnych wskazaniach żyroskopu.

  Forma ramki to: $G<uint8\_t> <uint8\_t> <uint8\_t>\#$;
  \newline

  Gdzie \# oznacza CRC. Przed nim znajdujdują się trzy wartości oddzielone spacją
  odnoszące się do aktualnych wskazań żyroskopu.

  \section{Wykres akcelometru}
  Jednym z założeń projektu było umieszczenie wykresów przyśpieszeń wszystkich
  trzech osi sterowanego pojazdu. Została podjęta decyzja scalenia tych wskazań
  do jednego dużego wykresu w celu zwiększenia czytelności. Przełożyło się to także
  na znaczną poprawę wydajności aplikacji. W celu dalszej optymalizacji 
  zaimplementowałem algorytm, który pozbywa się wskazań wychodzących poza okno 
  aplikacji. Wszystkie te działania sprawiły że dodanie tej funkcionalności
  nie wpłynęło znacząco na ogólną złożoność obliczeniową aplikacji.
  
  Wykres wyskalowany został w przedziale od -2G do +2G. Każda z odczytywanych osi
  ma swój własny kolor. W przypadku osi Z jest to kolor niebieski. 
  Dla osi X wybrany został kolor zielony, natomiast osi Y przypadł kolor czerwony.

  \section{Prototyp aplikacji}
  Obrazek pokazujący zaawansowany etap prac nad aplikacją.

  \begin{figure}[ht]
    \centering
    \includegraphics[width=1\textwidth]{img/app.png}
    \caption{Póżny prototyp aplikacji}
    \label{fig:interfejs}
  \end{figure}
  
  \newpage
  \section{Ostateczne rezultaty}
  Wszystkie zaplanowane kamienie milowe zostały osiągnięte. Aplikacja może 
  poszczycić się działającą obsługa joysticka, gotową komunikacją z robotem,
  wykresem przeciążeń, algorytmem różnicowego układu sterowania oraz działającym
  wskaźnikiem opóźnienia, prędkości liniowej i poziomu baterii. 
  Została również zaimplementowana wizualizacja obiektu 3D. 

  \begin{figure}[ht]
    \centering
    \includegraphics[width=1\textwidth]{img/final/app.png}
    \caption{Gotowa aplikacja}
    \label{fig:interfejs}
  \end{figure}

  \subsection{Okienko inicializacji połączenia}
  Aby uprościć interfejs urzytkownika, zdecydowałem się umieścić wszystkie aspekty
  związane z połączeniem w osobnym, specialnie zaprojektowanym do tego celu okienku.
  Wywoływane jest ono poprzez menu narzędziowe w zakładce "Connection".
  Znajdują się w nim sformatowane pola tekstowe, w które należy wpisać adres urządzenia
  docelowego oraz porty serwera UDP i TCP.  

  \begin{figure}[h]
    \centering
    \includegraphics[width=0.4\textwidth]{img/final/conn.png}
    \caption{Okienko konfiguracji połączenia}
    \label{fig:conn}
  \end{figure}



  \subsection{Okienko informacyjne}
  Okienko to można znaleźć w belce narzędziowej w zakładce "Help". 
  Jego celem jest informowanie urzytkownika o autorze aplikacji i
  jej przeznaczeniu. Dodatkowo informuje ona, gdzie można zgłaszać
  napotkane błędy. Podobnie jak okienko z konfiguracją połączenia, 
  wykorzustuje ono półprzezroczystość, co pozytywnie wpływa na ogólną
  estetykę aplikacji. W tej samej zakładce znaleźć można także odnośnik
  do repozytorium projektu.

  \begin{figure}[h]
    \centering
    \includegraphics[width=0.4\textwidth]{img/final/info.png}
    \caption{Okienko konfiguracji połączenia}
    \label{fig:info}
  \end{figure}


  \subsection{Wykresy przeciążeń}
  Jednym z najefektywniejszych wizualnie elementów jest wykres przeciążeń.
  Jego zadaniem jest przedstwianie wskazań pobranych z akcelometru robota.
  Pozwala nam to w bardzo przejrzysty sposób dowiedzieć się jakie siły
  działają na nasz pojazd. Został on wykonany przy użyciu modułu QTChart.
  Aby zmniejszyć jego wpływ na wydajność aplikacji wszystkie punkty, które
  nie mieszczą się na wykresie zostają usunięte. Ma to duży wpływ na użycie
  pamięci i procesora, w szczególności podczas dłuższej pracy z programem.

  \begin{figure}[h]
    \centering
    \includegraphics[width=0.5\textwidth]{img/final/chart.png}
    \caption{Wykres przeciążeń}
    \label{fig:chart}
  \end{figure}

  \subsection{Wizualizacja 3D}
  Wizualizacja robota w trówymiarze, jest najbardziej złożonym obliczeniowo
  elementem całego programu. Jego celem jest przekazanie urzytkownikowi 
  jaknajdokładniejszego odwzorowania pochylenia pojazdu względem podłoża.
  Jest to niezastąpione podczas podjazdów na strome zbocza lub przeprawy 
  w trudnym terenie. Na potrzeby tej części aplikacji, został stworzony
  bardzo dokłady model 3D sterowanego robota. Obraca się on  w zależności 
  od danych uzyskanych z żyroskopu robota. Po wielu przeprowadzonych
  testach zdecydowałem się na czerwone światło padające z przodu kamery,
  poniewa takie ustawienia dają najlepszy efekt wizualny.

  \begin{figure}[h]
    \centering
    \includegraphics[width=0.5\textwidth]{img/final/3d.png}
    \caption{Wizualizacja 3D}
    \label{fig:3d}
  \end{figure}


  \subsection{Wskaźniki}
  Ostatnim ważnym elementem są wskaźniki. Wyświetlają one dane z różnych
  czujników zainstalowanych na pojeździe. Pierwszy z nich otrzymuje odlegość
  zmierzoną przez czujnik ultradzwiękowy zamontowany na przodzie. Jest to 
  ważna informacja podczas zbliżana się do ścian lub innych obiektów.
  Pasek postępu wyskalowany jest do jednego metra, ponieważ powyżej tej 
  wartości nie musimy się obawiać zderzenia.

  \begin{figure}[h]
    \centering
    \includegraphics[width=1\textwidth]{img/final/wska.png}
    \caption{Wizualizacja 3D}
    \label{fig:indications}
  \end{figure}

  Z lewej strony znajdują się inforamcje dotyczące obliczonego opóźnienia i
  prędkości jazdy. W szczególności ta pierwsza jest niezwykle potrzebna, bo
  sprawia że w prosty sposób dowiadujemy się o zbliżającym się końcu zasięgu.
  Z prawej strony znajduje się status połączenia z robotem. Natomiast poniżej
  udostępniona jest nam aproksymacja poziomu naładowania akumulatora.


  \section{Eksperymenty}

  \subsection{Próba połączenia}

  \begin{figure}[ht]
    \centering
    \includegraphics[width=0.78\textwidth]{img/final/0.png}
    \includegraphics[width=0.78\textwidth]{img/final/0e.jpg}
    \caption{Próba połączenia}
  \end{figure}


  \subsection{Stanie na przeszkodzie}
  \begin{figure}[h]
    \centering
    \includegraphics[width=0.77\textwidth]{img/final/2.png}
    \includegraphics[width=0.77\textwidth]{img/final/2e.jpg}
    \caption{Stanie na przeszkodzie}
  \end{figure}

  \subsection{Zjazd z górki}
  \begin{figure}[h]
    \centering
    \includegraphics[width=0.77\textwidth]{img/final/3.png}
    \includegraphics[width=0.77\textwidth]{img/final/3e.jpg}
    \caption{Zjazd z górki}
  \end{figure}


  \subsection{Stanie bokiem}
  \begin{figure}[h]
    \centering
    \includegraphics[width=0.77\textwidth]{img/final/4.png}
    \includegraphics[width=0.77\textwidth]{img/final/4e.jpg}
    \caption{Stanie bokiem}
  \end{figure}


  
  
\bibliographystyle{plplain}
\bibliography{baza_bibliografii}
\end{document}

